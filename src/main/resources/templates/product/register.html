<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìƒí’ˆ ë“±ë¡</title>
    <style>
        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form div {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* íŒ¨ë”©ì´ ë„ˆë¹„ì— í¬í•¨ë˜ë„ë¡ ì„¤ì • */
        }
        textarea {
            resize: vertical;
            height: 100px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .submit-btn {
            background-color: #007bff;
            color: white;
        }
        .back-btn {
            background-color: #6c757d;
            color: white;
        }
        .image-preview-container {
            margin-top: 15px;
            text-align: center;
            border: 1px dashed #ccc;
            padding: 10px;
        }
        #image-preview {
            max-width: 100%;
            max-height: 200px;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }
        .message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ†• ìƒˆ ìƒí’ˆ ë“±ë¡</h1>

    <div id="status-message" class="message"></div>

    <form id="register-form" enctype="multipart/form-data">
        <div>
            <label for="name">ìƒí’ˆ ì´ë¦„:</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div>
            <label for="description">ìƒí’ˆ ì„¤ëª…:</label>
            <textarea id="description" name="description" required></textarea>
        </div>
        <div>
            <label for="stock">ì¬ê³  ìˆ˜ëŸ‰:</label>
            <input type="number" id="stock" name="stock" min="0" value="1" required>
        </div>
        <div>
            <label for="imageFile">ìƒí’ˆ ì´ë¯¸ì§€ íŒŒì¼:</label>
            <input type="file" id="imageFile" name="imageFile" accept="image/*">
        </div>
        <div class="image-preview-container">
            <p>ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</p>
            <img id="image-preview" src="#" alt="ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
        </div>

        <div>
            <button type="submit" class="submit-btn">âœ… ìƒí’ˆ ë“±ë¡</button>
            <button type="button" class="back-btn" onclick="location.href='/products'">ğŸ”™ ëª©ë¡ìœ¼ë¡œ</button>
            <button type="button" class="back-btn" onclick="location.href='/'">ğŸ  ë©”ì¸ í˜ì´ì§€</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('imageFile').addEventListener('change', function(event) {
        const preview = document.getElementById('image-preview');
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        } else {
            preview.src = '#';
            preview.style.display = 'none';
        }
    });

    document.getElementById('register-form').addEventListener('submit', function(event) {
        event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

        const form = event.target;
        // FormDataë¥¼ ì‚¬ìš©í•˜ì—¬ í¼ ë°ì´í„° (í…ìŠ¤íŠ¸ í•„ë“œì™€ íŒŒì¼)ë¥¼ í•œ ë²ˆì— ìˆ˜ì§‘
        const formData = new FormData(form);
        const statusMessage = document.getElementById('status-message');

        // ì¬ê³ ë¥¼ ìˆ«ìë¡œ ë³€í™˜ (FormDataëŠ” ëª¨ë“  ê°’ì„ ë¬¸ìì—´ë¡œ ì²˜ë¦¬)
        // formData.set('stock', parseInt(formData.get('stock'))); // Java Serviceì—ì„œ Integerë¡œ ìë™ ë³€í™˜ ì²˜ë¦¬ ê°€ëŠ¥ì„± ìˆìŒ

        // API ì—”ë“œí¬ì¸íŠ¸: POST /api/product
        fetch('/api/product', {
            method: 'POST',
            // íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•´ Content-Typeì„ ì§€ì •í•˜ì§€ ì•ŠìŒ (ë¸Œë¼ìš°ì €ê°€ multipart/form-dataë¥¼ ìë™ ì„¤ì •)
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    return response.json(); // ì„±ê³µ ì‹œ ì‘ë‹µ ë³¸ë¬¸ (ë“±ë¡ëœ ìƒí’ˆ ID ë“±) ì²˜ë¦¬
                }
                // 4xx, 5xx ì—ëŸ¬ ì²˜ë¦¬
                return response.text().then(text => { throw new Error(text || 'ìƒí’ˆ ë“±ë¡ ì‹¤íŒ¨: ì„œë²„ ì˜¤ë¥˜'); });
            })
            .then(data => {
                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                statusMessage.className = 'message success';
                statusMessage.textContent = `âœ¨ ìƒí’ˆ ë“±ë¡ ì„±ê³µ! ëª©ë¡ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`;
                statusMessage.style.display = 'block';
                form.reset(); // í¼ ì´ˆê¸°í™”
                document.getElementById('image-preview').style.display = 'none'; // ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€
            })
            .catch(error => {
                console.error('ë“±ë¡ ì˜¤ë¥˜:', error);
                // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                statusMessage.className = 'message error';
                statusMessage.textContent = 'âŒ ìƒí’ˆ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                statusMessage.style.display = 'block';
            });
    });
</script>
</body>
</html>