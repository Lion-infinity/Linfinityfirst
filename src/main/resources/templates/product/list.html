<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>ìƒí’ˆ ëª©ë¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto 20px auto;
        }
        .button-group {
            display: flex;
            gap: 10px;
        }
        .button-group button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .register-btn {
            background-color: #28a745;
            color: white;
        }
        .register-btn:hover {
            background-color: #1e7e34;
        }
        .home-btn {
            background-color: #6c757d;
            color: white;
        }
        .home-btn:hover {
            background-color: #5a6268;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .product-card {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s;
        }
        .product-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        /* â­ï¸ ìƒí’ˆ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼: ë†’ì´ 300px ê³ ì • ë° ì˜ë¦¼ ë°©ì§€ (contain) â­ï¸ */
        .product-card img {
            width: 100%;       /* ë„ˆë¹„ë¥¼ ì¹´ë“œì˜ ì „ì²´ ë„ˆë¹„ë¡œ ì„¤ì • */
            height: 300px;     /* ë†’ì´ë¥¼ 300pxë¡œ ê³ ì • */
            object-fit: contain; /* ì´ë¯¸ì§€ê°€ ì˜ë¦¬ì§€ ì•Šê³  ì „ì²´ê°€ ë³´ì´ë„ë¡ ë¹„ìœ¨ ìœ ì§€ */
            border-radius: 6px;
            margin-bottom: 10px;
            background-color: #f0f0f0; /* ì´ë¯¸ì§€ê°€ ì±„ìš°ì§€ ëª»í•œ ë°°ê²½ ì˜ì—­ ìƒ‰ìƒ */
        }
        .product-card h3 {
            font-size: 1.2em;
            margin: 5px 0;
        }
        .product-card a {
            text-decoration: none;
            color: #007bff;
        }
        .product-card a:hover {
            text-decoration: underline;
        }
        .empty-list-message {
            text-align: center;
            margin-top: 50px;
            font-size: 1.2em;
            color: #888;
        }
    </style>
</head>
<body>

<div class="product-header">
    <h1>ğŸ›’ ìƒí’ˆ ëª©ë¡</h1>
    <div class="button-group">

        <a th:href="@{/product/register}" sec:authorize="hasAnyRole('SELLER', 'ADMIN', 'ROOT')">
            <button class="register-btn">â¬†ï¸ ìƒˆ ìƒí’ˆ ë“±ë¡</button>
        </a>

        <a th:href="@{/}" class="home-btn-link">
            <button class="home-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
        </a>
    </div>
</div>

<div id="product-list" class="product-grid">
</div>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', fetchProducts);

    function fetchProducts() {
        // ìƒí’ˆ ëª©ë¡ API ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
        fetch('/api/product')
            .then(response => {
                if (!response.ok) {
                    throw new Error('ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(products => {
                const container = document.getElementById('product-list');
                container.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

                if (products.length === 0) {
                    container.innerHTML = '<p class="empty-list-message">í˜„ì¬ ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. â¬†ï¸ **ìƒˆ ìƒí’ˆ ë“±ë¡** ë²„íŠ¼ì„ ì´ìš©í•´ ìƒí’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”.</p>';
                    return;
                }

                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';

                    // imageUrlì´ null ë˜ëŠ” ë¹„ì–´ ìˆì„ ê²½ìš° ëŒ€ì²´ ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •
                    const imageUrl = product.imageUrl && product.imageUrl.trim() !== ''
                        ? product.imageUrl
                        : '/images/default-placeholder.png'; // ëŒ€ì²´ ì´ë¯¸ì§€ ê²½ë¡œ

                    productCard.innerHTML = `
                            <a href="/products/${product.productId}">
                                <img src="${imageUrl}" alt="${product.name} ì´ë¯¸ì§€">
                            </a>
                            <h3><a href="/products/${product.productId}">${product.name}</a></h3>
                            <p>ì¬ê³ : ${product.stock}</p>
                            <p>íŒë§¤ì: ${product.sellerName}</p>
                        `;
                    container.appendChild(productCard);
                });
            })
            .catch(error => {
                console.error('ìƒí’ˆ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                document.getElementById('product-list').innerHTML = `<p class="empty-list-message" style="color: red;">ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
            });
    }
</script>
</body>
</html>