<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>QnA 게시판 - Linfinity Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-10">

<div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">QnA 게시판</h1>
        <div class="space-x-2">
            <a href="/qna/write" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">글쓰기</a>
            <a href="/login" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">로그인</a>
        </div>
    </div>

    <table class="min-w-full leading-normal">
        <thead>
        <tr>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">상태</th>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">제목</th>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">작성자</th>
            <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">작성일</th>
        </tr>
        </thead>
        <tbody id="qnaList">
        <!-- 자바스크립트로 데이터가 여기에 들어옵니다 -->
        </tbody>
    </table>
</div>

<script>
    // 페이지 로드 시 목록 가져오기
    window.onload = function() {
        fetch('/api/qna')
            .then(response => response.json())
            .then(data => {
                const listBody = document.getElementById('qnaList');
                listBody.innerHTML = ''; // 초기화

                data.forEach(qna => {
                    const statusBadge = qna.answered
                        ? `<span class="bg-green-200 text-green-800 py-1 px-2 rounded-full text-xs">답변완료</span>`
                        : `<span class="bg-gray-200 text-gray-800 py-1 px-2 rounded-full text-xs">대기중</span>`;

                    // 날짜 포맷팅 (YYYY-MM-DD)
                    const date = qna.questionCreatedAt ? qna.questionCreatedAt.substring(0, 10) : '-';

                    const row = `
                        <tr class="hover:bg-gray-50 cursor-pointer" onclick="location.href='/qna/${qna.qnaId}'">
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${statusBadge}</td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm font-medium text-blue-600">${qna.title}</td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${qna.username}</td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${date}</td>
                        </tr>
                    `;
                    listBody.innerHTML += row;
                });
            })
            .catch(error => console.error('Error:', error));
    };
</script>

</body>
</html>