<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>질문 상세 - Linfinity Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-10 flex justify-center">

<div class="bg-white p-8 rounded shadow-md w-full max-w-3xl">
    <!-- 질문 영역 -->
    <div class="border-b pb-6 mb-6">
        <h1 id="title" class="text-3xl font-bold mb-2">제목 로딩중...</h1>
        <div class="text-gray-500 text-sm mb-4">
            작성자: <span id="username" class="font-semibold text-gray-700"></span> |
            작성일: <span id="createdAt"></span>
        </div>
        <div id="question" class="text-gray-800 whitespace-pre-wrap leading-relaxed"></div>
    </div>

    <!-- 답변 영역 -->
    <div id="answerSection" class="bg-gray-50 p-6 rounded mb-6 hidden">
        <h3 class="font-bold text-lg text-green-700 mb-2">💡 관리자 답변</h3>
        <div id="answerContent" class="text-gray-700 whitespace-pre-wrap"></div>
        <div id="answeredAt" class="text-xs text-gray-400 mt-2 text-right"></div>
    </div>

    <!-- 답변 작성 폼 (관리자/판매자용) -->
    <!-- 실제 권한 체크는 서버에서 하지만, 편의상 UI는 열어둠 -->
    <div class="mt-8 pt-6 border-t">
        <h3 class="font-bold text-gray-700 mb-2">답변 달기 (관리자 전용)</h3>
        <textarea id="newAnswer" class="w-full px-3 py-2 border rounded h-24 mb-2" placeholder="답변 내용을 입력하세요"></textarea>
        <button onclick="submitAnswer()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm">
            답변 등록
        </button>
    </div>

    <div class="mt-6">
        <a href="/qna" class="text-blue-500 hover:underline">← 목록으로 돌아가기</a>
    </div>
</div>

<script>
    // URL에서 ID 추출 (예: /qna/1 -> 1)
    const qnaId = window.location.pathname.split("/").pop();

    // 상세 정보 가져오기
    window.onload = function() {
        fetch(`/api/qna/${qnaId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('title').innerText = data.title;
                document.getElementById('username').innerText = data.username;
                document.getElementById('question').innerText = data.question;
                document.getElementById('createdAt').innerText = data.questionCreatedAt ? data.questionCreatedAt.replace('T', ' ') : '';

                // 답변이 있으면 보여주기
                if (data.answered) {
                    document.getElementById('answerSection').classList.remove('hidden');
                    document.getElementById('answerContent').innerText = data.answer;
                    document.getElementById('answeredAt').innerText = '답변일: ' + (data.answeredAt ? data.answeredAt.substring(0, 10) : '');
                }
            })
            .catch(error => alert('글을 불러오지 못했습니다.'));
    };

    // 답변 등록
    function submitAnswer() {
        const answerText = document.getElementById('newAnswer').value;
        if(!answerText) {
            alert("내용을 입력해주세요.");
            return;
        }

        fetch(`/api/qna/${qnaId}/answer`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ answer: answerText })
        })
            .then(async response => {
                if (response.ok) {
                    alert("답변이 등록되었습니다.");
                    window.location.reload(); // 새로고침
                } else {
                    alert("답변 등록 실패! (권한이 없거나 오류 발생)");
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script>

</body>
</html>